WindowManager:
    HomeWindow:
    MainWindow:
    SecondWindow:
    ProteinWindow:
    ExpressionWindow:
    WrongWindow:
    BacterialWindow:
    PurificationWindow:
    IonExchangeWindow:
    iex2Window:
    iex2bWindow:
    iex3Window:
    Expression3Window:
    Expression4Window:
    BamhiWindow:
    StickyAmpicilinWindow:
    LastExpressionWindow:
    LacWindow:
    SECWindow:
    SEC2Window
    BackPurificationWindow:
    AffinityWindow:
    HydrophobicWindow:
    hic2Window:
    hic3Window:
    AffinityQuestionWindow:
    FinalWindow:
    AffinityQbWindow:
    AffinityQcWindow:
    AffinityQdWindow:
    AffinityQeWindow:

<HomeWindow>:
    name: "home"

    GridLayout:
        cols: 1
        size: root.width, root.height

        Label:
            text: "Welcome to Biochemistry 463L App\nLet's start with analysis of your protein. "

        Button:
            text: "Find out protein identity\n(start here)"
            on_release:
                app.root.current = "main"

        Button:
            text: "Learn about protein expression"
            on_release:
                app.root.current = "expression"

        Button:
            text: "Learn about protein purification"
            on_release:
                app.root.current = "purification"

        Button:
            text: "~*~ Reset ~*~\n[Deletes previously entered protein sequence and all generated data.\nRecommended before changing the analyzed protein.]"
            on_release:
                root.remove_files()

        Label:
            text: "Note to Mac users:\n If you encounter issues displaying images, go into full screen mode."

<MainWindow>:
    name: "main"
    sequence: sequence

    GridLayout:
        cols:1
        size: root.width, root.height

        GridLayout:
            cols:2

            Label:
                text: "Paste the sequence from the FASTA file.\nInclude the header.\n\nUse Command+C to paste the sequence.\n\nYou can enter any amino acid sequence."

            TextInput:
                id: sequence
                multinline: False

        Button:
            text:"Submit"
            on_release:
                root.btn()
                app.root.current = "second"

        Button:
            text: "Go back to home screen"
            on_release:
                app.root.current = "home"

<SecondWindow>:
    name: "second"
    inputfasta: inputfasta

    GridLayout:
        cols:1
        size: root.width, root.height

        Label:
            text: "We will use Basic Local Alignment Search Tool (BLAST) to find out the identity of this protein."

        Image:
            source: 'BLAST1.PNG'
            size: self.texture_size

        Label:
            text: "Is the following sequence correct?"

        Label:
            id: inputfasta
            text: "The sequence you entered should appear here. If you don't see it, start over."

        Image:
            source: 'BLAST2.PNG'
            size: self.texture_size

        Button:
            text: "Let's do this!"

            on_release:
                app.root.current = "protein"
                root.blastsearch()
                root.manager.transition.direction = "left"

        Button:
            text: "I made an error, take me back."
            on_release:
                app.root.current = "main"
                root.manager.transition.direction = "right"

<ProteinWindow>:
    name: "protein"
    protname: protname
    weight: weight

    GridLayout:
        cols:1
        size: root.width, root.height

        Label:
            text: "Your protein was identified!"

        Label:
            text: "Name of the species it came from is in square brackets [  ]"

        Label:
            id: protname
            text: "Something went wrong, try again!"

        Label:
            text: "Weight of this protein is:"

        Label:
            id: weight
            text: "The weight should appear here, something went wrong"

        Button:
            text: "Continue"
            on_release:
                app.root.current = "home"


<ExpressionWindow>:
    name: "expression"

    GridLayout:
        cols: 1
        size: root.width, root.height

        Label:
            text: "To study a protein, you need to have a sample.\nHow would you like to produce your protein?"

        Button:
            text: "Mammalian cell culture"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Order it on Amazon"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Bacterial cell culture"
            on_release:
                app.root.current = "bacterial"

        Button:
            text: "Order it on Fisher Scientific"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Go back to Home"
            on_release:
                app.root.current = "home"

<BacterialWindow>:
    name: "bacterial"

    GridLayout:
        cols: 1

        Label:
            text: "You need a circular vector to express your protein in bacteria.\nFor example, pET-3A vector can be used.\n\nHow many kilobases (kb) are in an uncloned pET3A vector?"

        Button:
            text: "Show pET-3A vector"
            on_release:
                root.showpet()

        Button:
            text: "3"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "4.6"
            on_release:
                app.root.current = "expression3"

        Button:
            text: "10"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "30"
            on_release:
                app.root.current = "wrong"


<Expression3Window>:
    name: "expression3"

    GridLayout:
        cols: 1

        Label:
            text: "How do you incorporate a desired gene into the vector?"

        Button:
            text: "Heat shock"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Restriction enzymes"
            on_release:
                app.root.current = "expression4"

        Button:
            text: "Synthesize the vector from the bases in a correct sequence."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Mix the vectors and the DNA for 24h in acidic solution."
            on_release:
                app.root.current = "wrong"

<Expression4Window>:

    name: "expression4"

    GridLayout:
        cols: 2

        Label:
            text: "Which restriction enzyme would you use with this vector?"

        Button:
            text: "Show me the sequence of pET-3A"
            on_release:
                root.showpetseq()

        Button:
            text: "NdeI"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "BamHI"
            on_release:
                app.root.current = "bamhi"

        Button:
            text: "EcoRI"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "NcoI"
            on_release:
                app.root.current = "wrong"

<P>:
    Label:
        id: pet3aseq
        text: "this should not show"
        text_size: root.width, None
        size: self.texture_size

<BamhiWindow>:
    name: "bamhi"

    GridLayout:
        cols: 1

        Label:
            text: "Restriction enzymes produce either sticky or blunt ends.\nWhich ones do you think are desired for vector incorporation?"

        Button:
            text: "Show sticky and blunt ends example"
            on_release:
                root.showends()
        Button:
            text: "Blunt ends are more desirable."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Sticky ends are more desirable."
            on_release:
                app.root.current = "stickyampicilin"


<StickyAmpicilinWindow>:
    name: "stickyampicilin"

    GridLayout:
        cols: 1

        Label:
            text: "How do you determine if bacteria picked up the vector?"

        Button:
            text: "All bacteria always pick up the vector."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Various stains are used to verify that."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "The leftover vector concentration is quantified."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Vector contains antibiotic resistance genes, so only those bacteria survive."
            on_release:
                app.root.current = "lac"

<LacWindow>:
    name: "lac"

    GridLayout:
        cols: 1

        Label:
            text: "Finally, how do you control when the desired protein is expressed?"

        Button:
            text: "By changing the incubation temperature of the bacteria."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "By addition of lysozyme, which induces the lac operon."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "By addition of Isopropyl thiogalactopyranoside (IPTG), which induces the lac operon."
            on_release:
                app.root.current = "lastexpression"

        Button:
            text: "By treatment with cyanogen bromide, which inhibits other proteins."
            on_release:
                app.root.current = "wrong"

<LastExpressionWindow>:
    name: "lastexpression"

    GridLayout:
        cols: 1

        Label:
            text: "Correct! You are done with this module!"

        Button:
            text: "Continue to Purification Module"
            on_release:
                app.root.current = "purification"

        Button:
            text: "Go back Home"
            on_release:
                app.root.current = "home"
                root.manager.transition.direction = "right"

<PurificationWindow>:
    name: "purification"

    GridLayout:
        cols:2

        GridLayout:
            cols: 2

            Label:
                text: "Following methods are available:"

            Button:
                text: "1. Size-exclusion chromatography\n   (SEC)"
                on_release:
                    app.root.current = "sec"

            Button:
                text: "2. Ion-exchange chromatography\n   (IEX)"
                on_release:
                    app.root.current = "ionexchange"

            Button:
                text: "3. Hydrophobic interaction chromatography\n   (HIC)"
                on_release:
                    app.root.current = "hydrophobic"

            Button:
                text: "4. Affinity chromatography\n   (AC)"
                on_release:
                    app.root.current = "affinity"

            Button:
                text: "Go back to Home"
                on_release:
                    app.root.current = "home"
                    root.manager.transition.direction = "right"

<IonExchangeWindow>:
    name: "ionexchange"

    GridLayout:
        cols: 1
        Label:
            text: "In ion-exchange chromatography, charged molecules in the sample\nare separated by the electrostatic forces of attraction when passed\nthrough the ionic resin at particular pH and temperature.\n\nThe separation occurs by reversible exchange of ions between the\nions present in the solution and those present in the ion exchange resin."

        Button:
            text: "Show me how it works!"
            on_release:
                root.showiex()

        Button:
            text: "Continue to next question"
            on_release:
                app.root.current = "iex2"

        Button:
            text: "Go back to Home"
            on_release:
                app.root.current = "home"


<iex2Window>:
    name: "iex2"
    isoelectric: isoelectric

    GridLayout:
        cols: 1

        Label:
            text: "IEX column may use a positive or negative resin. For the protein to bind,\nbuffer with proper pH must be selected."

        Button:
            text: "Show me the rules of buffer selection."
            on_release:
                root.showiexrule()

        Label:
            id: isoelectric
            text: "You pI should be displayed here."

        Button:
            text: "Continue to next question.\nYou will need information from this window to answer."
            on_release:
                app.root.current = "iex2b"

<iex2bWindow>:
    name: "iex2b"

    GridLayout:
        cols: 1
        Label:
            text: "In cation exchange chromatography:"

        Button:
            text: "The molecule of interest and resin are both positive."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "The molecule of interest is positive and the resin in negative."
            on_release:
                app.root.current = "iex3"

        Button:
            text: "The molecule of interest is negative and the resin is positive."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "The molecule of interest and resin are both negative."
            on_release:
                app.root.current = "wrong"

<iex3Window>:
    name: "iex3"

    GridLayout:
        cols: 1
        Label:
            text: "If the resin has a negative charge and pI = 6.3,\nwhat is a good pH for the buffer used IEX?"

        Button:
            text: "7.5"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "6.3"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "5.0"
            on_release:
                app.root.current = "backPurification"

        Button:
            text: "4.0"
            on_release:
                app.root.current = "wrong"


<SECWindow>:
    name: "sec"

    GridLayout:
        cols: 1
        Label:
            text: "In size- exclusion chromatography, molecules are separated based on their size\nas they pass through a resin packed column.\n\nChoose the correct statement below:"

        Button:
            text: "Show me how it works!"
            on_release:
                root.showSEC()

        Button:
            text: "Larger molecules are eluted faster, because they are heavier."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Larger molecules are eluted faster, because they don't get trapped in the resin pores."
            on_release:
                app.root.current = "sec2"

        Button:
            text: "Go back to Home"
            on_release:
                app.root.current = "home"
                root.manager.transition.direction = "right"

<SEC2Window>:
    name: "sec2"

    GridLayout:
        cols: 1

        Label:
            text: "What do you think is the main downside of SEC?"

        Button:
            text: "E.coli might produce a protein that has the same size as the target protein."
            on_release:
                app.root.current = "backPurification"

        Button:
            text: "The protein might be cleaved by the resin."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "This technique only works in a narrow pH range."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Sometimes proteins bind irreversibly with the resin."
            on_release:
                app.root.current = "wrong"


<BackPurificationWindow>:
    name: "backPurification"

    GridLayout:
        cols: 1

        Label:
            text: "Correct! Proceed with the next technique."

        Button:
            text: "Go back to list of purification techniques"
            on_release:
                app.root.current = "purification"

        Button:
            text: "Go back to Home"
            on_release:
                app.root.current = "home"
                root.manager.transition.direction = "right"


<AffinityWindow>:
    name: "affinity"

    GridLayout:
        cols: 1
        Label:
            text: "Affinity chromatography utilizes reversible affinity interaction\nbetween target proteins and the stationary phase.\n\nFor example, polyhistidine tag (His-tag) can be used with a nickle column.\n\nIn this setup, the target analyte is eluted with a buffer that contains imidazole. "

        Button:
            text: "Show me how it works!"
            on_release:
                root.showaffinity()

        Button:
            text: "Continue to next question"
            on_release:
                app.root.current = "AffinityQuestion"
        Button:
            text: "Go back to Home"
            on_release:
                app.root.current = "home"
                root.manager.transition.direction = "right"

<AffinityQuestionWindow>:
    name: "AffinityQuestion"

    GridLayout:
        cols: 1
        Label:
            text: "Is affinity chromatography applicable to all proteins?"

        Button:
            text: "Yes, there are no limitations."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "No, it has to be of a specific size."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Yes, but the proteins need to be derivatized after extraction."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "No, the his-tag needs to be added during the expression step."
            on_release:
                app.root.current = "AffinityQb"

<AffinityQbWindow>:
    name: "AffinityQb"

    GridLayout:
        cols:1

        Label:
            text: "How do you add his-tags to a protein?"

        Button:
            text: "You mix it with histidine in pH = 10 buffer"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "You can only use this method with proteins naturally containing histidine."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "You choose a circular vector that has his-tag sequence."
            on_release:
                app.root.current = "AffinityQc"

        Button:
            text: "You have to use mammalian expression system."
            on_release:
                app.root.current = "wrong"

<AffinityQcWindow>:
    name: "AffinityQc"

    GridLayout:
        cols: 1

        Label:
            text: "How do you remove the his-tags after chromatography?"

        Button:
            text: "You don't, they don't change much in the protein."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "You use thrombin cleavage kit."
            on_release:
                app.root.current = "AffinityQd"

        Button:
            text: "You use mercaptoethanol."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "You use HindIII enzyme."
            on_release:
                app.root.current = "wrong"

<AffinityQdWindow>:
    name: "AffinityQd"

    GridLayout:
        cols: 1

        Label:
            text: "What column would you use in affinity chromatography of a protein with His-tag?"

        Button:
            text: "C18 column"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Silica hel column"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Nickel column"
            on_release:
                app.root.current = "AffinityQe"

        Button:
            text: "Desalting column"
            on_release:
                app.root.current = "wrong"

<AffinityQeWindow>:
    name: "AffinityQe"

    GridLayout:
        cols: 1

        Label:
            text: "If imidazole is used to elute the target analyte,\nhow can it be later separated from the protein?"

        Button:
            text: "Show imidazole structure"
            on_release:
                root.showimidazole()

        Button:
            text: "Size exclusion chromatography"
            on_release:
                app.root.current = "final"

        Button:
            text: "Second run on nickel column"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Extraction with water"
            on_release:
                app.root.current = "wrong"

        Button:
            text: "It evaporates"
            on_release:
                app.root.current = "wrong"

<HydrophobicWindow>:
    name: "hydrophobic"

    GridLayout:
        cols: 1
        Label:
            text: "Sample molecules containing hydrophobic and hydrophilic regions\nare applied to an HIC column in a high-salt buffer. The salt in the buffer\nreduces the solvation of sample solutes. As solvation decreases,\nhydrophobic regions that become exposed are adsorbed by the media.\nThe more hydrophobic the molecule, the less salt is needed\nto promote binding."

        Button:
            text: "Show me how HIC works!"
            on_release:
                root.showhic()

        Button:
            text: "Continue to next question"
            on_release:
                app.root.current = "hic2"

        Button:
            text: "Go back to Home"
            on_release:
                app.root.current = "home"
                root.manager.transition.direction = "right"

<hic2Window>:
    name: "hic2"

    GridLayout:
        cols: 1

        Label:
            text: "Amino acids have different levels of hydrophobicity."

        Button:
            text: "Show me how amino acids are classified."
            on_release:
                root.showaa()

        Button:
            text: "Continue to next question"
            on_release:
                app.root.current = "hic3"

<hic3Window>:
    name: "hic3"

    GridLayout:
        cols: 1

        Label:
            text: "What possible issues with this separation technique do you see?"

        Button:
            text: "Our protein does not have hydrophobic amino acids."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "Our protein does not have hydrophilic amino acids."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "We need to use a special vector\n- to introduce hydrophobic amino acids to our protein."
            on_release:
                app.root.current = "wrong"

        Button:
            text: "It is not specific enough\n- many proteins in E.coli have similar hydrophobicity."
            on_release:
                app.root.current = "backPurification"

<WrongWindow>:
    name: "wrong"

    GridLayout:
        cols: 1

        Label:
            text: "That's not the answer we were looking for."

        Button:
            text: "Try again!"
            on_release:
                app.root.current = "home"

<FinalWindow>:
    name: "final"

    GridLayout:
        cols: 1

        Label:
            text: "Correct!"

        Label:
            text: "Thank you! That's all we had for you."

        Button:
            text: "Show summary of all purification techniques"
            on_release:
                root.showallpurification()

        Button:
            text: "Go back to Home"
            on_release:
                app.root.current = "home"
